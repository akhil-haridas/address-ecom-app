<%- include('../adminlayouts/adminhead.ejs') %>
    <section id="sidebar">
        <a href="/admin/home" class="brand">
            <i class='bx bxs-smile'></i>
            <span class="text">Welcome, A D M I N </span>
        </a>
        <ul class="side-menu top">
            <li>
                <a href="/admin/home">
                    <i class='bx bxs-dashboard'></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li class="active">
                <a href="/admin/products">
                    <i class='bx bxs-shopping-bag'></i>
                    <span class="text">Products</span>
                </a>
            </li>
            <li>
                <a href="/admin/orders">
                    <i class='bx bxs-cart'></i>
                    <span class="text">Orders</span>
                </a>
            </li>
            <li>
                <a href="/admin/customers" id="cust">
                    <i class='bx bxs-group'></i>
                    <span class="text">Customers</span>
                </a>
            </li>
            <li>
                <a href="/admin/category">
                    <i class='bx bxs-category'></i>
                    <span class="text">Category</span>
                </a>
            </li>
            <li>
                <a href="/admin/banners">
                    <i class='bx bxs-message-dots'></i>
                    <span class="text">Banners</span>
                </a>
            </li>
            <li>
                <a href="/admin/coupons">
                    <i class='bx bxs-purchase-tag'></i>
                    <span class="text">Coupons</span>
                </a>
            </li>
        </ul>
        <ul class="side-menu">
            <li>
                <a href="/admin/setting">
                    <!-- <i class='bx bxs-cog'></i> -->
                    <span class=""></span>
                </a>
            </li>
            <li>
                <a href="/admin/logout" class="logout">
                    <i class='bx bxs-log-out-circle'></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>
    <!-- SIDEBAR -->
    <!-- CONTENT -->
    <section id="content">
        <!-- NAVBAR -->
        <nav>
            <i class='bx bx-menu'></i>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Search..." name="search" aria-label="search" style="display: none;">
                    <button type="submit" style="background: none;" class=""><i class='bx bx-search'></i></button>
                </div>
            </form>
            <input type="checkbox" id="switch-mode" hidden>
            <label for="switch-mode" class="switch-mode"></label>
            <a href="#" class="">
                <!-- <i class='bx bxs-bell'></i> -->
                <span class=""></span>
            </a>
        </nav>
        <!-- NAVBAR -->

        <!-- MAIN -->
        <main>
            <div class="head-title">
                <div class="left">
                    <h1>Products</h1>
                    <ul class="breadcrumb">
                        <li>
                            <a href="/admin/products">Product</a>
                        </li>
                        <li><i class='bx bx-chevron-right'></i></li>
                        <li>
                            <a class="" href="/admin/products">Product management</a>
                        </li>
                        <li><i class='bx bx-chevron-right'></i></li>
                        <li>
                            <a class="active" href="/admin/overview">Overview Product</a>
                        </li>
                    </ul>
                </div>
                <a class="btn-download" style="background: red;" onclick="removeProduct('<%= product._id %>')">
                    <i class='bx bx-x-circle'></i>
                    <span class="text">Remove</span>
                </a>
            </div>
            <div class="table-data" style="padding: 10px;">
                <div class="order">
                    <div class="head">
                        <p style="font-size: 20px;">about&emsp;<span style="font-size: 30px; color: #3C91E6; text-transform: uppercase; font-weight: bolder;"><%= product.name %></span></p>
                    </div>
                    <div class="card mb-4">
                        <% for(let i=0 ; i<product.image.length;i++){%>

                            <div class="slideshow-container" style="width: 250px;">
                                <div class="mySlides fade" style="width: 250px;">
                                    <div class="numbertext">
                                        <%= [i+1] %> /
                                            <%= product.image.length %>
                                    </div>
                                    <img src="/products_img/<%=product.image[i]%>" style="width:100%">
                                </div>
                                <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                                <a class="next" onclick="plusSlides(1)">&#10095;</a>
                            </div>
                            <%  } %>
                                <br>

                    </div>
                    <div class="formbold-main-wrapper">
                        <div class="formbold-form-wrapper">
                            <form action="" method="post" style="margin-left: -130px; margin-right: -130px; margin-top: -30px;" enctype="multipart/form-data">
                                <div class="formbold-input-flex">
                                    <div>
                                        <input type="text" name="name" id="firstname" value="<%= product.name %>" class="formbold-form-input" />
                                        <label for="firstname" class="formbold-form-label"> Product Name </label>
                                    </div>
                                    <div>
                                        <input type="text" name="brand" id="lastname" value="<%= product.brand %>" class="formbold-form-input" />
                                        <label for="lastname" class="formbold-form-label"> Brand </label>
                                    </div>
                                </div>

                                <div class="formbold-input-flex">
                                    <div>
                                        <input type="number" name="grossprice" id="email" value="<%= product.grossPrice %>" class="formbold-form-input" />
                                        <label for="email" class="formbold-form-label"> Gross Price </label>
                                    </div>
                                    <div>
                                        <input type="number" name="offerprice" id="phone" value="<%= product.offerPrice %>" class="formbold-form-input" />
                                        <label for="phone" class="formbold-form-label"> Offer Price </label>
                                    </div>
                                </div>
                                <div class="formbold-input-flex">
                                    <div>
                                        <select style="margin-top: 12px; border: none; background: transparent;" name="category">
                    <option value="<%=product.category._id%>" class="formbold-form-input"><%=product.category.category%></option>
                    <% for(category of categories){%>
                    <option class="formbold-form-input text-dark" value="<%= category._id %>">
                      <%= category.category %>
                    </option>
                    <% } %>
                  </select>
                                        <label for="email" class="formbold-form-label"> Category </label>
                                    </div>
                                    <div>
                                        <select style="margin-top: 12px; border: none; background: transparent;" name="size">
                    <option value="<%= product.stock %>" class="formbold-form-input"><%= product.size %></option>
                    <option value="" class="formbold-form-input">M - MEDIUM</option>
                    <option value="" class="formbold-form-input">L - LARGE</option>
                    <option value="" class="formbold-form-input">XL - XTRA LARGE</option>
                    <option value="" class="formbold-form-input">XXL - DOUBLE XTRA LARGE</option>
                  </select>
                                        <label for="email" class="formbold-form-label">Size</label>
                                    </div>

                                </div>
                                <div class="formbold-input-flex">
                                    <div>
                                        <input type="number" name="stock" id="phone" value="<%= product.stock %>" class="formbold-form-input" />
                                        <label for="phone" class="formbold-form-label"> Stock </label>
                                    </div>
                                </div>

                                <div class="formbold-textarea">
                                    <textarea rows="6" name="description" id="message" placeholder="" class="formbold-form-input"><%= product.description %></textarea>
                                    <label for="message" class="formbold-form-label"> Description </label>
                                </div>
                        </div>
                    </div>
                    <div>
                        <ul>
                            <% product.image.forEach(imageName=> { %>
                                <li>
                                    <span class="formbold-filename">
                <%= imageName %>
            
                <svg style="color: red;" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" onclick="removeImage('<%= imageName %>')">

                        <path
                            d="M9.00005 7.93906L12.7126 4.22656L13.7731 5.28706L10.0606 8.99956L13.7731 12.7121L12.7126 13.7726L9.00005 10.0601L5.28755 13.7726L4.22705 12.7121L7.93955 8.99956L4.22705 5.28706L5.28755 4.22656L9.00005 7.93906Z"
                            fill="#536387" />
                </svg>
            </span>
                                </li>
                                <% }); %>
                        </ul>
                        <label for="phone" class="formbold-form-label"><i class='bx bx-image-add'></i> Attach Files(Currently Max Limit - <%= 6 - product.image.length %>) </label>
                        <input type="file" name="upload" id="file-input" accept="image/*" placeholder="" class="formbold-form-input" max="<%= Math.max(0, 6 - product.image.length) %>" multiple />
                        <div id="preview"></div>
                    </div>
                    <input type="hidden" name="productId" value="<%= product._id %>">
                    <button class="formbold-btn" type="submit">Update changes</button>
                    </form>
                </div>
            </div>
            </main>
    </section>
    <script>
        function removeProduct(productId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    location.href = '/admin/remove_product?id=' + productId
                }
            })
        }
    </script>
    <script>
        function removeImage(image) {

            $.ajax({
                url: `remove_image/${image}`,
                method: 'get',
                success: function(response) {
                    if (response.status === true) {
                        const productId = response.Product;
                        window.location.reload();
                    } else {
                        Swal.fire('Can not delete, failed ')

                    }
                }
            })
        }
    </script>
    <script>
        const input = document.querySelector('input[type="file"]');
        const preview = document.querySelector('#preview');
        const fileInput = document.getElementById('file-input');
        const maxLimit = input.getAttribute('max');


        fileInput.addEventListener('change', (event) => {
            console.log(maxLimit, 'ethi ')
            preview.innerHTML = '';
            const selectedFiles = event.target.files;

            if (selectedFiles.length > maxLimit) {
                Swal.fire(`Maximum ${maxLimit} files can be uploaded.`)
                    // clear the selected files from input
                fileInput.value = '';
            } else {
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const reader = new FileReader();

                    reader.onload = () => {
                        const img = document.createElement('img');
                        img.src = reader.result;
                        img.style.width = '100px';
                        preview.appendChild(img);
                    };

                    reader.readAsDataURL(file);
                }
            }
        });
    </script>

    <%- include('../adminlayouts/adminfooter.ejs') %>